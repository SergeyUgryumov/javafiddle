<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html">
    <h:head>
        <title>Java Fiddle</title>
        <h:outputStylesheet library="css" name="style.css" />
        <h:outputScript library="js" name="jquery-1.10.2.min.js" target="head"/>
        <h:outputScript library="js" name="main.js" target="head"/>
        <h:outputScript library="js" name="projecttree.js" target="head"/>
        <script type="text/javascript" src="#{request.contextPath}/resources/js/tooglepopup.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/resources/cm/lib/codemirror.js"></script>
        <link rel="stylesheet" type="text/css" href="#{request.contextPath}/resources/cm/lib/codemirror.css"></link>
        <script type="text/javascript" src="#{request.contextPath}/resources/cm/mode/javascript/javascript.js"></script>
        <!-- Start of editor scripts -->
        <script type="text/javascript" src="#{request.contextPath}/resources/cm/mode/clike/clike.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/resources/cm/addon/edit/matchbrackets.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/resources/cm/addon/edit/closebrackets.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/resources/cm/addon/fold/brace-fold.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/resources/cm/addon/fold/comment-fold.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/resources/cm/addon/fold/foldcode.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/resources/cm/addon/fold/foldgutter.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/resources/cm/addon/fold/indent-fold.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/resources/cm/addon/dialog/dialog.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/resources/cm/addon/search/searchcursor.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/resources/cm/addon/search/search.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/resources/cm/addon/selection/active-line.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/resources/cm/addon/hint/show-hint.js"></script>
        <script type="text/javascript" src="#{request.contextPath}/resources/cm/addon/hint/anyword-hint.js"></script>
        
        <link rel="stylesheet" type="text/css" href="#{request.contextPath}/resources/cm/addon/fold/fold.css"></link>
        <link rel="stylesheet" type="text/css" href="#{request.contextPath}/resources/cm/addon/dialog/dialog.css"></link>
        <link rel="stylesheet" type="text/css" href="#{request.contextPath}/resources/cm/addon/hint/show-hint.css"></link>
        <!-- End of editor scripts -->
        <style media="all" type="text/css">
            @import url("#{request.contextPath}/resources/css/osans.css");
        </style>
    </h:head>
    <h:body onload="showPopup('');">
        <div id="header">
            <div id="header-top">
                <div id="logo"> 
                    <div class="ltgt"><img src="resources/images/br_prev.ico"></img></div>
                    <h2><h:link value="JavaFiddle" outcome="index" /></h2>
                    <div class="ltgt"><img src="resources/images/br_next.ico"></img></div>
                </div>
                <h:panelGroup layout="block" id="projectname" >NetCrackerTasks</h:panelGroup>
                <h:panelGroup layout="block" id="username" >
                    <h:link value="snape@liceum8.ru" outcome="index" />
                </h:panelGroup>
                <div id="bottom"> 
                    <ul id="main_menu">
                        <li>Файл</li>
                        <li>Правка</li>
                        <li>Поиск</li>
                        <li>Вид</li>
                        <li>Настройки</li>
                        <li>История</li>
                    </ul>
                    <h:panelGroup layout="block" id="latest_update">Последнее изменение: 1 ноября 2012 г.</h:panelGroup>
                    <h:link id="share" value="Поделиться кодом" outcome="index" />
                </div>
            </div>
            <div id="header-bottom">
                <ul id="editor_buttons">
                    <li><h:commandButton value="" type="button" id="open" /></li>
                    <li><h:commandButton value="" type="button" id="save" /></li>
                    <li><h:commandButton value="" type="button" id="reload" /></li>
                    <div class="separator"></div>
                    <li></li>
                    <li></li>
                    <li><h:commandButton value="" type="button" id="undo" /></li>
                    <li><h:commandButton value="" type="button" id="redo" /></li>
                    <div class="separator"></div>
                    <li></li>
                    <li></li>
                    <li><h:commandButton value="" type="button" id="cut" /></li>
                    <li><h:commandButton value="" type="button" id="copy" /></li>
                    <li><h:commandButton value="" type="button" id="paste" /></li>
                    <div class="separator"></div>
                    <li></li>
                    <li></li>
                    <li><h:commandButton value="" type="button" id="run" /></li>
                    <div class="separator"></div>
                    <li></li>
                    <li></li>
                    <li><h:commandButton value="" type="button" id="setup" /></li>
                </ul>  
                <ul id="tabpanel">
                    <li class="class active" onclick="selectTab($(this))">WordProcessorImpl.java<div class="close" onclick="closeTab($(this).parent())"></div></li>
                    <li class="interface" onclick="selectTab($(this))">WordProcessor.java<div class="close" onclick="closeTab($(this).parent())"></div></li>
                    <li class="runnable" onclick="selectTab($(this))">WordProcessorTest.java<div class="close" onclick="closeTab($(this).parent())"></div></li>
                </ul>
                <div style="clear:both"></div>
            </div>
        </div>
        <div id="content">
            <h:panelGroup layout="block" id="treepanel" class="mainblock">
                <ul class="project">
                    <li class="open"><a href="#" class="root">NetCrackerTasks</a>
                        <ul>
                            <li><a href="#" class="folder">.idea</a></li>
                            <li class="open"><a href="#" class="sources">src</a>
                                <ul>
                                    <li><a href="#" class="package">ru.ncedu.java.tasks</a>
                                        <ul>
                                            <li><a href="#" class="package">ru.ncedu.java.tasks.sub</a>
                                                <ul>
                                                    <li><a href="#" class="folder">SMTHING ELSE</a>
                                                        <ul>
                                                            <li><a href="#" class="folder">SMTHING ELSE</a>
                                                                <ul>
                                                                    <li><a href="#" class="folder">SMTHING ELSE</a>
                                                                        <ul>
                                                                            <li><a href="#" class="folder">SMTHING ELSE</a>
                                                                                <ul>
                                                                                    <li><a href="#" class="class">ArrayVectorImpl</a></li>
                                                                                    <li><a href="#" class="interface">Employee</a></li>
                                                                                    <li><a href="#" class="class">EmployeeImpl</a></li>
                                                                                    <li><a href="#" class="interface">WordCounter</a></li>
                                                                                    <li><a href="#" class="class">WordCounterImpl</a></li>
                                                                                    <li><a href="#" class="interface">WordProcessor</a></li>
                                                                                    <li><a href="#" class="folder">AnotherFolder</a>
                                                                                        <ul>
                                                                                            <li><a href="#" class="class">ArrayVectorImpl</a></li>
                                                                                            <li><a href="#" class="interface">Employee</a></li>
                                                                                            <li><a href="#" class="class">EmployeeImpl</a></li>
                                                                                            <li><a href="#" class="interface">WordCounter</a></li>
                                                                                            <li><a href="#" class="class">WordCounterImpl</a></li>
                                                                                            <li><a href="#" class="interface">WordProcessor</a></li>
                                                                                            <li><a href="#" class="class">WordProcessorImpl</a></li>
                                                                                        </ul>
                                                                                    </li>
                                                                                </ul>
                                                                            </li>
                                                                        </ul>
                                                                    </li>
                                                                </ul>
                                                            </li>
                                                        </ul>
                                                    </li>
                                                </ul>
                                            </li>
                                            <li><a href="#" class="class">ArrayVectorImpl</a></li>
                                            <li><a href="#" class="interface">Employee</a></li>
                                            <li><a href="#" class="class">EmployeeImpl</a></li>
                                            <li><a href="#" class="interface">WordCounter</a></li>
                                            <li><a href="#" class="class">WordCounterImpl</a></li>
                                            <li><a href="#" class="interface">WordProcessor</a></li>
                                            <li><a href="#" class="class">WordProcessorImpl</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="#" class="runnable">ArrayVectorTest</a></li>
                                    <li><a href="#" class="runnable">WordCounterTest</a></li>
                                    <li><a href="#" class="runnable">WordProcessorTest</a></li>
                                </ul>
                            </li>
                            <li><a href="#" class="iml">NetCracketTasks.iml</a></li>
                        </ul>
                    </li>
                    <li><a href="#" class="lib">External Libraries</a></li>
                </ul>
                <script type="text/javascript">
                    //<![CDATA[
                        $(function () {
                            $('.project').liHarmonica({
                                onlyOne: false,
                                speed: 500
                            });
                        });
                    //]]>
                </script>
            </h:panelGroup>
            <div id="codetext" class="mainblock">
                <h:inputTextarea id="textarea" value="#{code.getText()}"/>
                <script type="text/javascript">
                //<![CDATA[
                    CodeMirror.commands.autocomplete = function(cm) {
                        CodeMirror.showHint(cm, CodeMirror.hint.anyword);
                    }
                    var javaEditor = CodeMirror.fromTextArea(document.getElementById("textarea"), {
                        lineNumbers: true,
                        lineWrapping: true,
                        styleActiveLine: true,
                        theme: "default",
                        indentWithTabs: true,
                        tabSize: 4,
                        indentUnit: 4,
                        mode: "text/x-java",
                        matchBrackets: true,
                        autoCloseBrackets: true,
                        extraKeys: {
                            "Ctrl-Q": function(cm){ cm.foldCode(cm.getCursor()); },
                            "Ctrl-S": function(){ push(); },
                            "Ctrl-Space": "autocomplete"
                        },
                        foldGutter: {
                            rangeFinder: new CodeMirror.fold.combine(CodeMirror.fold.brace, CodeMirror.fold.comment)
                        },    
                        gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"]
                    });
                    var height = $(window).height() - $("#header").height() - 30;
                    
                    javaEditor.setSize("100%", height);
                    javaEditor.foldCode(CodeMirror.Pos(8, 0));
                    function push() {
                        var jsonString = JSON.stringify(javaEditor.getValue());
                        document.getElementById("hiddenButton").value = jsonString;
                        remoteChangeCommand();
                        alert("Saved");
                    }

                    function pop() {
                        var jsonObject = JSON.parse(document.getElementById("hiddenButton").value);
                        javaEditor.setValue(jsonObject);
                    }
                    
                    function undo() {
                        javaEditor.undo();
                    }
                    
                    function redo() {
                        javaEditor.redo();
                    }

                //]]>
                </script>
            </div>
        </div>
    </h:body>
</html>
